{{ template "_header.html" . }}

<article>
    <hgroup>
        <h3>Manage WLED Controllers</h3>
        <p>Add or remove your WLED devices by name and IP address.</p>
    </hgroup>

    <form action="/settings/controllers" method="POST">
        <div class="grid">
            <label for="name">
                Controller Name
                <input type="text" id="name" name="name" placeholder="e.g., Main Shelf" required>
            </label>
            <label for="ip_address">
                IP Address
                <input type="text" id="ip_address" name="ip_address" placeholder="e.g., 192.168.1.50" required>
            </label>
        </div>
        <button type="submit">Add Controller</button>
    </form>

    <hr>

    <h4>Existing Controllers</h4>
    <table>
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">IP Address</th>
                <th scope="col">Status</th>
                <th scope="col">Bins</th>
                <th scope="col">Last Seen</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {{ if .Controllers }}
            {{ range .Controllers }}
            {{ template "_controller-row.html" . }}
            {{ end }}
            {{ else }}
            <tr>
                <td colspan="6" style="text-align: center;">No controllers found. Add one above!</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</article>

<article>
    <hgroup>
        <h3>Manage Bins</h3>
        <p>Map a physical bin location to a WLED Controller and Segment ID.</p>
    </hgroup>

    <h4>Bulk Add Segment Bins</h4>
    <form action="/settings/bins/bulk" method="POST">
        <div class="grid">
            <label for="bulk_controller_id">
                WLED Controller
                <select id="bulk_controller_id" name="controller_id" required>
                    <option value="" disabled selected>Select a controller...</option>
                    {{ range .Controllers }}
                    <option value="{{.ID}}">{{.Name}} ({{.IPAddress}})</option>
                    {{ end }}
                </select>
            </label>
            <label for="bulk_segment_id">
                Segment ID
                <input type="number" id="bulk_segment_id" name="segment_id" value="0" min="0" required>
            </label>
            <label for="led_count">
                Number of LEDs
                <input type="number" id="led_count" name="led_count" value="16" min="1" required>
            </label>
            <label for="name_prefix">
                Bin Name Prefix
                <input type="text" id="name_prefix" name="name_prefix" placeholder="e.g., A1:" required>
            </label>
        </div>
        <button type="submit" hx-confirm="This will create {{.led_count}} bins (e.g., A1:0, A1:1...). Are you sure?">
            Add Segment Bins
        </button>
    </form>

    <hr>

    <details>
        <summary role="button" class="outline secondary">Add a Single Bin Manually</summary>
        <form action="/settings/bins" method="POST">
            <div class="grid">
                <label for="bin_name">
                    Bin Name
                    <input type="text" id="bin_name" name="name" placeholder="e.g., A1-0" required>
                </label>
                <label for="controller">
                    WLED Controller
                    <select id="controller" name="controller_id" required>
                        <option value="" disabled selected>Select a controller...</option>
                        {{ range .Controllers }}
                        <option value="{{.ID}}">{{.Name}} ({{.IPAddress}})</option>
                        {{ end }}
                    </select>
                </label>
                <label for="segment_id">
                    Segment ID
                    <input type="number" id="segment_id" name="segment_id" value="0" min="0" required>
                </label>
                <label for="led_index">
                    LED Index
                    <input type="number" id="led_index" name="led_index" value="0" min="0" required>
                </label>
            </div>
            <button type="submit">Add Single Bin</button>
        </form>
    </details>

    <hr>

    <h4>Existing Bins</h4>
    <div class="scroll-table">
        <table>
            <thead>
                <tr>
                    <th scope="col">Bin Name</th>
                    <th scope="col">Controller</th>
                    <th scope="col">Segment ID</th>
                    <th scope="col">LED Index</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {{ if .Bins }}
                {{ range .Bins }}
                {{ template "_bin-row.html" . }}
                {{ end }}
                {{ else }}
                <tr>
                    <td colspan="5" style="text-align: center;">No bins found. Add one above!</td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>
</article>

<article>
    <h4>Maintenance</h4>
    <div class="grid">
        <div>
            <p>Remove any categories/tags that are no longer assigned to any part.</p>
        </div>
        <div>
            <button type="button" class="secondary" data-tooltip="Remove unused tags" hx-post="
                /settings/categories/cleanup" hx-swap="none"
                hx-confirm="This will permanently delete all unused tags. Are you sure?">
                Clean Up Unused Tags
            </button>
        </div>
    </div>
</article>

<h2>EXPERIMENTAL FEATURES</h2>

<article>
    <h4>Backup & Restore</h4>
    <p>Export your entire database including ploaded files to a single ZIP archive.</p>

    <div class="grid">
        <div>
            <h5>Backup</h5>
            <a href="/settings/backup/download" role="button" class="outline">
                Download Full Backup (.zip)
            </a>
        </div>
        <div>
            <h5>Restore</h5>
            <form action="/settings/backup/restore" method="POST" enctype="multipart/form-data">
                <label for="backup_file">
                    Select Backup File
                    <input type="file" id="backup_file" name="backup_file" accept=".zip" required>
                </label>
                <button type="submit" class="secondary"
                    hx-confirm="WARNING: This will completely wipe your current database and files and replace them with the backup. This cannot be undone. Are you sure?">
                    Restore from Backup
                </button>
            </form>
        </div>
    </div>
</article>

{{ template "_footer.html" . }}